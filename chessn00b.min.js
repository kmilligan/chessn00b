var BoardFactory;
(function(){"function"!==typeof Object.create&&(Object.create=function(a){function b(){}b.prototype=a;return new b});var n={R:"\u2656",N:"\u2658",B:"\u2657",Q:"\u2655",K:"\u2654",P:"\u2659",r:"\u265c",n:"\u265e",b:"\u265d",q:"\u265b",k:"\u265a",p:"\u265f",isWhite:function(a){return 91>a.charCodeAt(0)?!0:!1},getColor:function(a){return this.isWhite(a)?f.white:f.black}},p={1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8"},f={white:1,black:-1},r={init:function(a,
b){this.file=a;this.rank=b;this.color=0;this.name=p[a]+b;this.piece="";var d=0==a%2,c=0==b%2;if(!d&&c||d&&!c)this.color=1;return this},setPiece:function(a){if("undefined"===n[a])throw Error("Invalid piece");this.piece=a},removePiece:function(){this.piece=""},hasPiece:function(){return""==this.piece?!1:!0},getPiece:function(){return this.piece},isWhite:function(){return 1==this.color?!0:!1}},q={init:function(){this.colorToMove=f.white;this.enpassantTarget=this.castlingOptions="-";this.fullMoveNumber=
this.halfMoveClock=0;this.squares=[];for(var a=1;9>a;a++)for(var b=1;9>b;b++)1==b&&(this.squares[a]=[]),this.squares[a][b]=Object.create(r).init(a,b);return this},setFEN:function(a){a=a.split(" ");for(var b=a[0].split("/"),d=8;0<d;d--)this.setRankFEN(d,b[8-d]);this.colorToMove="w"==a[1]?f.white:f.black;a[2]&&(this.castlingOptions=a[2]);a[3]&&(this.enpassantTarget=a[3]);"undefined"!=typeof a[4]&&(this.halfMoveClock=parseInt(a[4],10));"undefined"!=typeof a[5]&&(this.fullMoveNumber=parseInt(a[5],10))},
setRankFEN:function(a,b){var d=b.split(""),c=1,e;for(e in d){if(8<c||" "==d[e])break;if(n[d[e]])this.setPiece(d[e],c,a),c++;else for(;0<d[e];)this.removePiece(c,a),d[e]--,c++}},getColorToMove:function(){return this.colorToMove},incrementMove:function(){this.colorToMove==f.white?this.colorToMove=f.black:(this.colorToMove=f.white,this.fullMoveNumber++)},setPiece:function(a,b,d){this.squares[b][d].setPiece(a)},removePiece:function(a,b){this.squares[a][b].removePiece()},getPiece:function(a,b){return this.squares[a][b].getPiece()},
getSquare:function(a,b){"undefined"==typeof b&&"string"==typeof a&&(b=a.substr(1,1),a=p[a.substr(0,1)]);return this.squares[a][b]},dump:function(){console.log("-----------------");for(var a=8;0<a;a--){for(var b="|",d=1;9>d;d++)b=this.squares[d][a].hasPiece()?b+this.squares[d][a].getPiece():b+" ",b+="|";console.log(b);console.log("-----------------")}}};BoardFactory=function(){return{create:function(){return Object.create(q).init()},getPieceMap:function(){return n},getFileMap:function(){return p},
getColorMap:function(){return f}}}()})();
(function(n){n.fn.chessn00b=function(a){a||(a={});if("string"==typeof a&&1==this.length&&this[0].displayboard)switch(a){case "fen":return this[0].displayboard.getFEN();default:return"unsupported option"}return this.each(function(){if(!this.displayboard){var b="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";a.fen&&(b=a.fen);a.element=n(this);this.displayboard=Object.create(q).init(a);this.displayboard.setFEN(b)}})};var p=BoardFactory.getPieceMap(),f={"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR":["e7e5"],
"rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppppppp/8/8/2P5/8/PP1PPPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R":["b8c6"],"rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR":["g7g6"]},r={init:function(a){this.square=a;this.element=n('<div class="chessn00b-square">&nbsp;</div>');this.element[0].displaySquare=this;this.element.attr("rel",this.square.name);this.element.addClass(this.square.color?"chessn00b-light-square":"chessn00b-dark-square");return this},
update:function(){this.square.hasPiece()?this.element.html(p[this.square.getPiece()]):this.element.html("&nbsp;")},lite:function(){this.element.addClass("chessn00b-square-lit")},unlite:function(){this.element.removeClass("chessn00b-square-lit")},toggleLite:function(){this.element.hasClass("chessn00b-square-lit")?this.unlite():this.lite()}},q={init:function(a){if(!a||!a.element)throw Error('Missing options; requires at least "element" to attach to.');"undefined"===typeof a.playGame&&(a.playGame=!0);
this.element=a.element;this.board=BoardFactory.create();this.engine=EngineFactory.create(this.board);this.playGame=a.playGame;this.lastClickedSquare=null;this.displaySquares=[];this.thinking=!1;this.id="board"+Math.floor(1E6*Math.random());this.element.addClass(this.id);for(a=1;9>a;a++)for(var b=1;9>b;b++)1==b&&(this.displaySquares[a]=[]),this.displaySquares[a][b]=Object.create(r).init(this.board.squares[a][b]);this.createDisplay();return this},createDisplay:function(){for(var a=8;0<a;a--){for(var b=
n('<div class="chessn00b-rank" rel="'+a+'"></div>'),d=1;9>d;d++)b.append(this.displaySquares[d][a].element);this.element.append(b)}this.element.append('<div class="chessn00b-status"><span class="illegal-move">Illegal move. </span><span class="your-move">Your move</span><span class="game-over">Game Over. </span><span class="you-win">You win!</span><span class="you-lose">You win!</span><span class="thinking">Thinking...</span></div>');this.element.find(".illegal-move").hide();this.element.find(".thinking").hide();
this.element.find(".game-over").hide();this.element.find(".you-lose").hide();this.element.find(".you-win").hide();this.playGame||this.element.find(".your-move").hide();this.autosetHeight();var c=this;this.element.on("click",".chessn00b-square",function(){c.squareClicked(n(this));return!1})},autosetHeight:function(){var a=this.displaySquares[1][1].element.width();"undefined"==typeof this.dynCSS&&(this.dynCSS=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.dynCSS));
a="."+this.id+" .chessn00b-square { font-size: "+Math.ceil(.82*a)+"px;  height: "+a+"px;  line-height: "+a+"px; }";this.dynCSS.styleSheet?this.dynCSS.styleSheet.cssText=a:this.dynCSS.innerHTML=a},squareClicked:function(a){this.thinking||(this.element.find(".illegal-move").hide(),this.lastClickedSquare?a[0]==this.lastClickedSquare?(this.lastClickedSquare.displaySquare.unlite(),this.lastClickedSquare=null):(this.lastClickedSquare.displaySquare.unlite(),a=""+this.lastClickedSquare.displaySquare.square.name+
a[0].displaySquare.square.name,this.engine.isValidMove(a)?(this.engine.move(a),this.update(),this.lastClickedSquare=null,this.playGame&&this.autoMove()):(this.element.find(".illegal-move").show(),this.lastClickedSquare=null)):(a[0].displaySquare.lite(),this.lastClickedSquare=a[0]))},autoMove:function(){this.thinking=!0;this.element.find(".your-move").hide();this.element.find(".thinking").show();var a=this;setTimeout(function(){var b;if(a.engine.blackInCheckmate())a.thinking=!1,a.element.find(".thinking").hide(),
a.element.find(".game-over").show(),a.element.find(".you-win").show();else{if(b=f[a.getFEN()]){var d=Math.round(Math.random()*(b.length-1));b=b[d];console.log("book move used")}else b=a.engine.getBestMoveForBlack();a.engine.move(b);a.thinking=!1;a.element.find(".thinking").hide();a.update();a.engine.whiteInCheckmate()?(a.element.find(".game-over").show(),a.element.find(".you-lose").show()):a.element.find(".your-move").show()}},0)},setFEN:function(a){this.board.setFEN(a);this.update()},getFEN:function(){return this.engine.getPositionFEN()},
update:function(){for(var a=1;9>a;a++)for(var b=1;9>b;b++)this.displaySquares[a][b].update()}}})(jQuery);if("undefined"===typeof BoardFactory)throw console&&console.log("Missing the BoardFactory!"),Error("Missing the BoardFactory!");var EngineFactory;
(function(){var n=BoardFactory.getPieceMap(),p=BoardFactory.getColorMap(),f={init:function(a){this.board=a;this.resetCaches();return this},resetCaches:function(){this.whiteCoveredSquares=[];this.blackCoveredSquares=[];this.blackDynamicValue=this.whiteDynamicValue=this.blackStaticValue=this.whiteStaticValue=0;this.cachedPositionFEN=null;this.validWhiteMoves=[];this.validBlackMoves=[]},getWhitesCoveredSquares:function(){this.determineCoveredSquares(!0);return this.whiteCoveredSquares},getBlacksCoveredSquares:function(){this.determineCoveredSquares(!1);
return this.blackCoveredSquares},getValidMovesForWhite:function(){this.determineValidMoves(!0);return this.validWhiteMoves},getValidMovesForBlack:function(){this.determineValidMoves(!1);return this.validBlackMoves},determineValidMoves:function(a){if(!(a&&0<this.validWhiteMoves.length||!a&&0<this.validBlackMoves.length)){a&&(this.validWhiteMoves=[]);a||(this.validBlackMoves=[]);for(var b,d,c,e,m=1;9>m;m++)for(var k=1;9>k;k++)if(this.board.squares[m][k].hasPiece()&&(b=this.board.squares[m][k].name,
c=n.isWhite(this.board.squares[m][k].getPiece()),c==a)){e=this.getValidMovesForSquare(m,k);for(var h=0;h<e.length;h++)d=""+b+e[h].name,c?this.validWhiteMoves.push(d):this.validBlackMoves.push(d)}}},getValidMovesForSquare:function(a,b){var d=[],c;c="object"==typeof a?a:this.board.squares[a][b];if(!c.hasPiece())return d;var e=c.getPiece(),m=n.isWhite(e),k="k"==e||"K"==e?!0:!1,e="p"==e||"P"==e?!0:!1,h=this.getPositionFEN(),g=EngineFactory.create(),l=this.getCoveredSquares(c);if(0==l.length)return d;
for(var s=0;s<l.length;s++)if(!(l[s].hasPiece()&&n.isWhite(l[s].getPiece())==m||e&&!l[s].hasPiece())){g.setFEN(h);var f=""+c.name+l[s].name;g.move(f,!0);m&&g.whiteInCheck()||!m&&g.blackInCheck()||d.push(l[s])}e&&(m?8>c.rank&&!this.board.squares[c.file][c.rank+1].hasPiece()&&(g.setFEN(h),f=""+c.name+this.board.squares[c.file][c.rank+1].name,g.move(f,!0),g.whiteInCheck()||d.push(this.board.squares[c.file][c.rank+1]),2!=c.rank||this.board.squares[c.file][c.rank+2].hasPiece()||(g.setFEN(h),f=""+c.name+
this.board.squares[c.file][c.rank+2].name,g.move(f,!0),g.whiteInCheck()||d.push(this.board.squares[c.file][c.rank+2]))):1<c.rank&&!this.board.squares[c.file][c.rank-1].hasPiece()&&(g.setFEN(h),f=""+c.name+this.board.squares[c.file][c.rank-1].name,g.move(f,!0),g.blackInCheck()||d.push(this.board.squares[c.file][c.rank-1]),7!=c.rank||this.board.squares[c.file][c.rank-2].hasPiece()||(g.setFEN(h),f=""+c.name+this.board.squares[c.file][c.rank-2].name,g.move(f,!0),g.blackInCheck()||d.push(this.board.squares[c.file][c.rank-
2]))));k&&(m&&!this.whiteInCheck()?(!(0<=this.board.castlingOptions.indexOf("K"))||this.board.squares[c.file+1][c.rank].hasPiece()||this.isSquareAttackedByBlack(this.board.squares[c.file+1][c.rank])||this.board.squares[c.file+2][c.rank].hasPiece()||this.isSquareAttackedByBlack(this.board.squares[c.file+2][c.rank])||d.push(this.board.squares[c.file+2][c.rank]),!(0<=this.board.castlingOptions.indexOf("Q"))||this.board.squares[c.file-1][c.rank].hasPiece()||this.isSquareAttackedByBlack(this.board.squares[c.file-
1][c.rank])||this.board.squares[c.file-2][c.rank].hasPiece()||this.isSquareAttackedByBlack(this.board.squares[c.file-2][c.rank])||d.push(this.board.squares[c.file-2][c.rank])):m||this.blackInCheck()||(!(0<=this.board.castlingOptions.indexOf("k"))||this.board.squares[c.file+1][c.rank].hasPiece()||this.isSquareAttackedByWhite(this.board.squares[c.file+1][c.rank])||this.board.squares[c.file+2][c.rank].hasPiece()||this.isSquareAttackedByWhite(this.board.squares[c.file+2][c.rank])||d.push(this.board.squares[c.file+
2][c.rank]),!(0<=this.board.castlingOptions.indexOf("q"))||this.board.squares[c.file-1][c.rank].hasPiece()||this.isSquareAttackedByWhite(this.board.squares[c.file-1][c.rank])||this.board.squares[c.file-2][c.rank].hasPiece()||this.isSquareAttackedByWhite(this.board.squares[c.file-2][c.rank])||d.push(this.board.squares[c.file-2][c.rank])));return d},isValidMove:function(a,b){var d;"object"==typeof a?d=a:(d=this.board.getSquare(a.substr(0,2)),b=this.board.getSquare(a.substr(2,2)));if(!d.hasPiece()||
n.getColor(d.getPiece())!=this.board.getColorToMove())return!1;d=this.getValidMovesForSquare(d);for(var c=0;c<d.length;c++)if(d[c]===b)return!0;return!1},determineCoveredSquares:function(a){if(!(a&&0<this.whiteCoveredSquares.length||!a&&0<this.blackCoveredSquares.legnth)){a&&(this.whiteCoveredSquares=[]);a||(this.blackCoveredSquares=[]);for(var b,d=1;9>d;d++)for(var c=1;9>c;c++)if(this.board.squares[d][c].hasPiece()){var e=n.isWhite(this.board.squares[d][c].getPiece());if(e==a){b=this.getCoveredSquares(d,
c);var m=this.blackCoveredSquares;e&&(m=this.whiteCoveredSquares);for(e=0;e<b.length;e++)m.push(b[e])}}}},getCoveredSquares:function(a,b){var d;"object"==typeof a?(d=a.file,b=a.rank):d=a;var c=[],e=[];switch(this.board.squares[d][b].getPiece()){case "K":case "k":c=this.getStraightOptions(d,b,1);e=this.getDiagonalOptions(d,b,1);break;case "Q":case "q":c=this.getStraightOptions(d,b,8);e=this.getDiagonalOptions(d,b,8);break;case "R":case "r":c=this.getStraightOptions(d,b,8);break;case "B":case "b":e=
this.getDiagonalOptions(d,b,8);break;case "N":case "n":c=this.getKnightOptions(d,b);break;case "P":case "p":c=this.getPawnOptions(d,b)}for(d=0;d<e.length;d++)c.push(e[d]);return c},getStraightOptions:function(a,b,d){for(var c=!1,e=!1,m=!1,k=!1,h=[],g=1;g<=d;g++)9>b+g&&!c&&(h.push(this.board.squares[a][b+g]),this.board.squares[a][b+g].hasPiece()&&(c=!0)),9>a+g&&!e&&(h.push(this.board.squares[a+g][b]),this.board.squares[a+g][b].hasPiece()&&(e=!0)),0<b-g&&!m&&(h.push(this.board.squares[a][b-g]),this.board.squares[a][b-
g].hasPiece()&&(m=!0)),0<a-g&&!k&&(h.push(this.board.squares[a-g][b]),this.board.squares[a-g][b].hasPiece()&&(k=!0));return h},getDiagonalOptions:function(a,b,d){for(var c=!1,e=!1,m=!1,k=!1,h,g,l=[],f=1;f<=d;f++)9>b+f&&(g=b+f,9>a+f&&!c&&(h=a+f,l.push(this.board.squares[h][g]),this.board.squares[h][g].hasPiece()&&(c=!0)),0<a-f&&!e&&(h=a-f,l.push(this.board.squares[h][g]),this.board.squares[h][g].hasPiece()&&(e=!0))),0<b-f&&(g=b-f,9>a+f&&!m&&(h=a+f,l.push(this.board.squares[h][g]),this.board.squares[h][g].hasPiece()&&
(m=!0)),0<a-f&&!k&&(h=a-f,l.push(this.board.squares[h][g]),this.board.squares[h][g].hasPiece()&&(k=!0)));return l},getKnightOptions:function(a,b){var d=[];0<a-1&&(9>b+2&&d.push(this.board.squares[a-1][b+2]),0<b-2&&d.push(this.board.squares[a-1][b-2]),0<a-2&&(9>b+1&&d.push(this.board.squares[a-2][b+1]),0<b-1&&d.push(this.board.squares[a-2][b-1])));9>a+1&&(9>b+2&&d.push(this.board.squares[a+1][b+2]),0<b-2&&d.push(this.board.squares[a+1][b-2]),9>a+2&&(9>b+1&&d.push(this.board.squares[a+2][b+1]),0<b-
1&&d.push(this.board.squares[a+2][b-1])));return d},getPawnOptions:function(a,b){var d=[];n.isWhite(this.board.squares[a][b].getPiece())?8>b&&(1<a&&d.push(this.board.squares[a-1][b+1]),8>a&&d.push(this.board.squares[a+1][b+1])):1<b&&(1<a&&d.push(this.board.squares[a-1][b-1]),8>a&&d.push(this.board.squares[a+1][b-1]));return d},findPiece:function(a){for(var b=[],d=1;9>d;d++)for(var c=1;9>c;c++)this.board.squares[d][c].hasPiece()&&this.board.squares[d][c].getPiece()==a&&b.push(this.board.squares[d][c]);
return b},isSquareAttacked:function(a){if(!a.hasPiece())return!1;var b;b=n.isWhite(a.getPiece())?this.getBlacksCoveredSquares():this.getWhitesCoveredSquares();for(var d=0;d<b.length;d++)if(b[d]===a)return!0;return!1},isSquareAttackedByWhite:function(a,b){var d;d="object"==typeof a?a:this.board.squares[a][b];for(var c=this.getWhitesCoveredSquares(),e=0;e<c.length;e++)if(c[e]===d)return!0;return!1},isSquareAttackedByBlack:function(a,b){var d;d="object"==typeof a?a:this.board.squares[a][b];for(var c=
this.getBlacksCoveredSquares(),e=0;e<c.length;e++)if(c[e]===d)return!0;return!1},getPositionFEN:function(){if(this.cachedPositionFEN)return this.cachedPositionFEN;for(var a=[],b=8;0<b;b--){for(var d="",c=0,e=1;9>e;e++)this.board.squares[e][b].hasPiece()?(0<c&&(d+=c,c=0),d+=this.board.squares[e][b].getPiece()):c++;0<c&&(d+=c);a.push(d)}return this.cachedPositionFEN=a.join("/")},setFEN:function(a){this.resetCaches();this.board.setFEN(a)},blackInCheck:function(){var a=this.findPiece("k");return 0==a.length?
!1:this.isSquareAttacked(a[0])},whiteInCheck:function(){var a=this.findPiece("K");return 0==a.length?!1:this.isSquareAttacked(a[0])},blackInCheckmate:function(){var a=this.findPiece("k");return 0==a.length?!1:this.isSquareAttacked(a[0])&&0==this.getValidMovesForSquare(a[0]).length},whiteInCheckmate:function(){var a=this.findPiece("K");return 0==a.length?!1:this.isSquareAttacked(a[0])&&0==this.getValidMovesForSquare(a[0]).length},moves:function(a){"string"==typeof a&&(a=a.split(" "));for(var b=0;b<
a.length;b++)if(!this.move(a[b]))return!1;return!0},move:function(a,b){b=!0===b?!0:!1;var d=a.substr(0,2),c=a.substr(2,2);4<a.length&&a.substr(4,1);d=this.board.getSquare(d);if(!d||!d.hasPiece())return!1;c=this.board.getSquare(c);if(!b&&!this.isValidMove(d,c))return!1;var e=d.getPiece();d.removePiece();c.setPiece(e);"k"!=e&&"K"!=e||2!=Math.abs(d.file-c.file)||(c.file>d.file?(d=this.board.squares[c.file+1][c.rank],c=this.board.squares[c.file-1][c.rank]):(d=this.board.squares[c.file-2][c.rank],c=this.board.squares[c.file+
1][c.rank]),e=d.getPiece(),d.removePiece(),c.setPiece(e));this.board.incrementMove();this.resetCaches();return!0},getWhiteStaticValue:function(){this.determineStaticValues();return this.whiteStaticValue},getBlackStaticValue:function(){this.determineStaticValues();return this.blackStaticValue},determineStaticValues:function(){if(!(0<this.whiteStaticValue||0<this.blackStaticValue)){this.blackStaticValue=this.whiteStaticValue=0;for(var a,b=1;9>b;b++)for(var d=1;9>d;d++)if(this.board.squares[b][d].hasPiece()){switch(this.board.squares[b][d].getPiece()){case "Q":case "q":a=
9;break;case "R":case "r":a=5;break;case "B":case "b":a=3;break;case "N":case "n":a=3;break;case "P":case "p":a=1;break;default:continue}a*=10;n.isWhite(this.board.squares[b][d].getPiece())?this.whiteStaticValue+=a:this.blackStaticValue+=a}}},getWhiteDynamicValue:function(){this.determineDynamicValues();return this.whiteDynamicValue},getBlackDynamicValue:function(){this.determineDynamicValues();return this.blackDynamicValue},determineDynamicValues:function(){if(!(0<this.whiteDynamicValue||0<this.blackDynamicValue)){this.blackDynamicValue=
this.whiteDynamicValue=0;2<=this.findPiece("b").length&&(this.blackDynamicValue+=10);2<=this.findPiece("B").length&&(this.whiteDynamicValue+=10);var a=this.getBlacksCoveredSquares();this.blackDynamicValue+=Math.round(a.length/1);a=this.getWhitesCoveredSquares();this.whiteDynamicValue+=Math.round(a.length/1)}},getBestMoveForWhite:function(){return this.getBestMove(!0)},getBestMoveForBlack:function(){return this.getBestMove(!1)},getBestMoveSimple:function(a){for(var b=[],d=1;9>d;d++)for(var c=1;9>c;c++)if(this.board.squares[d][c].hasPiece()&&
n.isWhite(this.board.squares[d][c].getPiece())==a){var e=this.getValidMovesForSquare(d,c);if(0!=e.length)for(var f=0;f<e.length;f++){var k=""+this.board.squares[d][c].name+e[f].name,h=this.evaluateMove(k);if(1E3==Math.abs(h))return k;b.push({move:k,value:h})}}d=function(a,b){return a.value-b.value};a&&(d=function(a,b){return b.value-a.value});b.sort(d);if(this.mark)for(f=0;f<b.length;f++)console.log(b[f].move+": "+b[f].value);return b[0].move},evaluateMove:function(a){var b=this.clone();b.move(a);
return b.evaluatePosition()},clone:function(){var a=EngineFactory.create();a.setFEN(this.getPositionFEN()+" "+(this.board.getColorToMove()==p.white?"w":"b"));return a}},r,q;f.getBestMove=function(a){this.lastBestMove="";r=this.lastValue=0;q={};var b=(new Date).getTime();this.alphabeta(3,-1E4,1E4,a);b=((new Date).getTime()-b)/1E3;console.log((a?"white":"black")+" to move ;examined: "+r+" nodes in "+b+"s; best: "+this.lastBestMove+" ("+this.lastValue+")");return this.lastBestMove};f.alphabeta=function(a,
b,d,c){r++;var e=this.getPositionFEN()+" "+(this.board.getColorToMove()==p.white?"w":"b"),f;if(0==a){if(q[e])return q[e];f=this.evaluatePosition();return q[e]=f}var k=this.clone(),h,g;if(c){h=this.getValidMovesForWhite();for(var l=0;l<h.length;l++){k.setFEN(e);k.move(h[l]);g=b;if(k.blackInCheckmate()){b=1E3;this.lastBestMove=h[l];this.lastValue=b;break}else f=k.alphabeta(a-1,b,d,!c),b=Math.max(b,f);g!=b&&(this.lastBestMove=h[l],this.lastValue=f);if(d<=b)break}return b}h=this.getValidMovesForBlack();
for(l=0;l<h.length;l++){k.setFEN(e);k.move(h[l]);g=d;if(k.whiteInCheckmate()){d=-1E3;this.lastBestMove=h[l];this.lastValue=d;break}else f=k.alphabeta(a-1,b,d,!c),d=Math.min(d,f);g!=d&&(this.lastBestMove=h[l],this.lastValue=d);if(d<=b)break}return d};f.evaluatePosition=function(){if(this.whiteInCheckmate())return-1E3;if(this.blackInCheckmate())return 1E3;var a;a=0+this.getWhiteStaticValue();a-=this.getBlackStaticValue();a+=this.getWhiteDynamicValue();return a-=this.getBlackDynamicValue()};EngineFactory=
function(){return{create:function(a){"undefined"===typeof a&&(a=BoardFactory.create());return Object.create(f).init(a)}}}()})();
