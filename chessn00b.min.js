var BoardFactory;
(function(){"function"!==typeof Object.create&&(Object.create=function(c){function d(){}d.prototype=c;return new d});var h={R:"\u2656",N:"\u2658",B:"\u2657",Q:"\u2655",K:"\u2654",P:"\u2659",r:"\u265c",n:"\u265e",b:"\u265d",q:"\u265b",k:"\u265a",p:"\u265f",isWhite:function(c){return 91>c.charCodeAt(0)?!0:!1},getColor:function(c){return this.isWhite(c)?g.white:g.black}},n={1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",name:function(c,d){return n[c]+
d},coords:function(c){return{file:parseInt(n[c.substr(0,1)],10),rank:parseInt(c.substr(1,1),10)}}},g={white:8,black:0},q={init:function(){this.colorToMove=g.white;this.enpassantTarget=this.castlingOptions="-";this.fullMoveNumber=this.halfMoveClock=0;this.squares=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.squareColors=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];return this},copyFrom:function(c){this.squares=c.squares.slice();this.colorToMove=c.colorToMove;this.castlingOptions=c.castlingOptions;
this.enpassantTarget=c.enpassantTarget;this.haveMoveClock=c.halfMoveClock;this.fullMoveNumber=c.fullMoveNumber},setFEN:function(c){c=c.split(" ");for(var d=c[0].split("/"),a=8;0<a;a--)this.setRankFEN(a,d[8-a]);this.colorToMove="w"==c[1]?g.white:g.black;c[2]&&(this.castlingOptions=c[2]);c[3]&&(this.enpassantTarget=c[3]);"undefined"!=typeof c[4]&&(this.halfMoveClock=parseInt(c[4],10));"undefined"!=typeof c[5]&&(this.fullMoveNumber=parseInt(c[5],10))},setRankFEN:function(c,d){var a=d.split(""),b=1,e;
for(e in a){if(8<b||" "==a[e])break;if(h[a[e]])this.setPiece(a[e],b,c),b++;else for(;0<a[e];)this.removePiece(b,c),a[e]--,b++}},getColorToMove:function(){return this.colorToMove},incrementMove:function(){this.colorToMove==g.white?this.colorToMove=g.black:(this.colorToMove=g.white,this.fullMoveNumber++)},ap:function(c,d){return 10*(10-parseInt(d,10))+parseInt(c,10)},apToName:function(c){return n.name(c%10,10-Math.floor(c/10))},setPiece:function(c,d,a){this.squares[this.ap(d,a)]=c},removePiece:function(c,
d){this.squares[this.ap(c,d)]=0},hasPiece:function(c,d){var a;a="undefined"===typeof d?c:this.ap(c,d);return"string"===typeof this.squares[a]?!0:!1},getPiece:function(c,d){return this.squares[this.ap(c,d)]},getSquareColor:function(c,d){"undefined"==typeof d&&"string"==typeof c&&(d=c.substr(1,1),c=n[c.substr(0,1)]);return this.squareColors[this.ap(c,d)]},getCoveredSquares:function(c,d){var a=[],b=[];switch(this.getPiece(c,d)){case "K":case "k":a=this.getStraightOptions(c,d,1);b=this.getDiagonalOptions(c,
d,1);break;case "Q":case "q":a=this.getStraightOptions(c,d,8);b=this.getDiagonalOptions(c,d,8);break;case "R":case "r":a=this.getStraightOptions(c,d,8);break;case "B":case "b":b=this.getDiagonalOptions(c,d,8);break;case "N":case "n":a=this.getKnightOptions(c,d);break;case "P":case "p":a=this.getPawnOptions(c,d)}for(var e=0;e<b.length;e++)a.push(b[e]);return a},getStraightOptions:function(c,d,a){for(var b=[],e=[-1,-10,1,10],r=this.ap(c,d),f,l=0;l<e.length;l++)for(d=e[l],f=r,c=0;c<a;){f+=d;if(0>this.squares[f])break;
b.push(this.apToName(f));if(this.hasPiece(f))break;c++}return b},getDiagonalOptions:function(c,d,a){for(var b=[],e=[-11,-9,9,11],r=this.ap(c,d),f,l=0;l<e.length;l++)for(d=e[l],f=r,c=0;c<a;){f+=d;if(0>this.squares[f])break;b.push(this.apToName(f));if(this.hasPiece(f))break;c++}return b},getKnightOptions:function(c,d){for(var a=[],b=[-21,-19,-8,12,21,19,8,-12],e,r=this.ap(c,d),f=0;f<b.length;f++)e=b[f],e=r+e,0>this.squares[e]||a.push(this.apToName(e));return a},getPawnOptions:function(c,d){for(var a=
[],b=h.isWhite(this.getPiece(c,d))?[-11,-9]:[11,9],e,r=this.ap(c,d),f=0;f<b.length;f++)e=b[f],e=r+e,0>this.squares[e]||a.push(this.apToName(e));return a},dump:function(){console.log("-----------------");for(var c=8;0<c;c--){for(var d="|",a=1;9>a;a++)d=this.hasPiece(a,c)?d+this.getPiece(a,c):d+" ",d+="|";console.log(d);console.log("-----------------")}}};BoardFactory=function(){return{create:function(){return Object.create(q).init()},getPieceMap:function(){return h},getFileMap:function(){return n},
getColorMap:function(){return g}}}()})();
(function(h){h.fn.chessn00b=function(b){b||(b={});if("string"==typeof b&&1==this.length&&this[0].displayboard)switch(b){case "fen":return this[0].displayboard.getFEN();default:return"unsupported option"}return this.each(function(){if(!this.displayboard){var e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";b.fen&&(e=b.fen);b.element=h(this);this.displayboard=Object.create(a).init(b);this.displayboard.setFEN(e)}})};var n=BoardFactory.getPieceMap(),g=BoardFactory.getColorMap(),q=BoardFactory.getFileMap(),
c={"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR":["e7e5"],"rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppppppp/8/8/2P5/8/PP1PPPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R":["b8c6"],"rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR":["g7g6"]},d={init:function(b){this.square=b;this.element=h('<div class="chessn00b-square">&nbsp;</div>');this.element[0].displaySquare=this;this.element.attr("rel",b.name);this.element.addClass(this.square.color==g.white?
"chessn00b-light-square":"chessn00b-dark-square");return this},lite:function(){this.element.addClass("chessn00b-square-lit")},unlite:function(){this.element.removeClass("chessn00b-square-lit")},toggleLite:function(){this.element.hasClass("chessn00b-square-lit")?this.unlite():this.lite()}},a={init:function(b){if(!b||!b.element)throw Error('Missing options; requires at least "element" to attach to.');"undefined"===typeof b.playGame&&(b.playGame=!0);this.element=b.element;this.board=BoardFactory.create();
this.engine=EngineFactory.create(this.board);this.playGame=b.playGame;this.lastClickedSquare=null;this.displaySquares=[];this.thinking=!1;this.id="board"+Math.floor(1E6*Math.random());this.element.addClass(this.id);for(b=1;9>b;b++)for(var a=1;9>a;a++)1==a&&(this.displaySquares[b]=[]),this.displaySquares[b][a]=Object.create(d).init({file:b,rank:a,color:this.board.getSquareColor(b,a),name:q.name(b,a)});this.createDisplay();return this},createDisplay:function(){for(var b=8;0<b;b--){for(var a=h('<div class="chessn00b-rank" rel="'+
b+'"></div>'),c=1;9>c;c++)a.append(this.displaySquares[c][b].element);this.element.append(a)}this.element.append('<div class="chessn00b-status"><span class="illegal-move">Illegal move. </span><span class="your-move">Your move</span><span class="game-over">Game Over. </span><span class="you-win">You win!</span><span class="you-lose">You win!</span><span class="thinking">Thinking...</span></div>');this.element.find(".illegal-move").hide();this.element.find(".thinking").hide();this.element.find(".game-over").hide();
this.element.find(".you-lose").hide();this.element.find(".you-win").hide();this.playGame||this.element.find(".your-move").hide();this.autosetHeight();var f=this;this.element.on("click",".chessn00b-square",function(){f.squareClicked(h(this));return!1})},autosetHeight:function(){var b=this.displaySquares[1][1].element.width();"undefined"==typeof this.dynCSS&&(this.dynCSS=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.dynCSS));b="."+this.id+" .chessn00b-square { font-size: "+
Math.ceil(.82*b)+"px;  height: "+b+"px;  line-height: "+b+"px; }";this.dynCSS.styleSheet?this.dynCSS.styleSheet.cssText=b:this.dynCSS.innerHTML=b},squareClicked:function(b){this.thinking||(this.element.find(".illegal-move").hide(),this.lastClickedSquare?b[0]==this.lastClickedSquare?(this.lastClickedSquare.displaySquare.unlite(),this.lastClickedSquare=null):(this.lastClickedSquare.displaySquare.unlite(),b=""+this.lastClickedSquare.displaySquare.square.name+b[0].displaySquare.square.name,this.engine.isValidMove(b)?
(this.engine.move(b),this.update(),this.lastClickedSquare=null,this.playGame&&this.autoMove()):(this.element.find(".illegal-move").show(),this.lastClickedSquare=null)):(b[0].displaySquare.lite(),this.lastClickedSquare=b[0]))},autoMove:function(){this.thinking=!0;this.element.find(".your-move").hide();this.element.find(".thinking").show();var b=this;setTimeout(function(){var a;b.engine.blackInCheckmate()?(b.thinking=!1,b.element.find(".thinking").hide(),b.element.find(".game-over").show(),b.element.find(".you-win").show()):
((a=c[b.getFEN()])?(a=a[Math.round(Math.random()*(a.length-1))],console.log("book move used")):a=b.engine.getBestMoveForBlack(),b.engine.move(a),b.thinking=!1,b.element.find(".thinking").hide(),b.update(),b.engine.whiteInCheckmate()?(b.element.find(".game-over").show(),b.element.find(".you-lose").show()):b.element.find(".your-move").show())},0)},setFEN:function(b){this.board.setFEN(b);this.update()},getFEN:function(){return this.engine.getPositionFEN()},update:function(){for(var b=1;9>b;b++)for(var a=
1;9>a;a++)this.board.hasPiece(b,a)||this.displaySquares[b][a].element.html("&nbsp;"),this.displaySquares[b][a].element.html(n[this.board.getPiece(b,a)])}}})(jQuery);if("undefined"===typeof BoardFactory)throw console&&console.log("Missing the BoardFactory!"),Error("Missing the BoardFactory!");var EngineFactory;
(function(){var h=BoardFactory.getPieceMap(),n=BoardFactory.getColorMap(),g=BoardFactory.getFileMap(),q={init:function(a){this.board=a;this.resetCaches();return this},resetCaches:function(){this.whiteCoveredSquares=[];this.blackCoveredSquares=[];this.blackDynamicValue=this.whiteDynamicValue=this.blackStaticValue=this.whiteStaticValue=0;this.cachedPositionFEN=null;this.validWhiteMoves=[];this.validBlackMoves=[]},getWhitesCoveredSquares:function(){this.determineCoveredSquares(!0);return this.whiteCoveredSquares},
getBlacksCoveredSquares:function(){this.determineCoveredSquares(!1);return this.blackCoveredSquares},getValidMovesForWhite:function(){this.determineValidMoves(!0);return this.validWhiteMoves},getValidMovesForBlack:function(){this.determineValidMoves(!1);return this.validBlackMoves},determineValidMoves:function(a){if(!(a&&0<this.validWhiteMoves.length||!a&&0<this.validBlackMoves.length)){a&&(this.validWhiteMoves=[]);a||(this.validBlackMoves=[]);for(var b,e,c,f,d=1;9>d;d++)for(var k=1;9>k;k++)if(this.board.hasPiece(d,
k)&&(b=g.name(d,k),c=h.isWhite(this.board.getPiece(d,k)),c==a)){f=this.getValidMovesForSquare(d,k);for(var m=0;m<f.length;m++)e=""+b+f[m],c?this.validWhiteMoves.push(e):this.validBlackMoves.push(e)}}},getValidMovesForSquare:function(a,b){var e=[];if(!this.board.hasPiece(a,b))return e;var c=this.board.getPiece(a,b),f=h.isWhite(c),d="k"==c||"K"==c?!0:!1,c="p"==c||"P"==c?!0:!1,k=g.name(a,b);this.getPositionFEN();var m=EngineFactory.create(),t=this.board.getCoveredSquares(a,b);if(0==t.length)return e;
for(var n,q,p,u=0;u<t.length;u++)n=g[t[u].substr(0,1)],q=t[u].substr(1,1),p=this.board.hasPiece(n,q),n=this.board.getPiece(n,q),p&&h.isWhite(n)==f||c&&!p||(m.setFromBoard(this.board),p=""+k+t[u],m.move(p,!0),f&&m.whiteInCheck()||!f&&m.blackInCheck()||e.push(t[u]));c&&(f?8>b&&!this.board.hasPiece(a,b+1)&&(m.setFromBoard(this.board),p=""+k+g.name(a,b+1),m.move(p,!0),m.whiteInCheck()||e.push(g.name(a,b+1)),2!=b||this.board.hasPiece(a,b+2)||(m.setFromBoard(this.board),p=""+k+g.name(a,b+2),m.move(p,!0),
m.whiteInCheck()||e.push(g.name(a,b+2)))):1<b&&!this.board.hasPiece(a,b-1)&&(m.setFromBoard(this.board),p=""+k+g.name(a,b-1),m.move(p,!0),m.blackInCheck()||e.push(g.name(a,b-1)),7!=b||this.board.hasPiece(a,b-2)||(m.setFromBoard(this.board),p=""+k+g.name(a,b-2),m.move(p,!0),m.blackInCheck()||e.push(g.name(a,b-2)))));d&&(f&&!this.whiteInCheck()?(!(0<=this.board.castlingOptions.indexOf("K"))||this.board.hasPiece(a+1,b)||this.isSquareAttackedByBlack(a+1,b)||this.board.hasPiece(a+2,b)||this.isSquareAttackedByBlack(a+
2,b)||e.push(g.name(a+2,b)),!(0<=this.board.castlingOptions.indexOf("Q"))||this.board.hasPiece(a-1,b)||this.isSquareAttackedByBlack(a-1,b)||this.board.hasPiece(a-2,b)||this.isSquareAttackedByBlack(a-2,b)||e.push(g.name(a-2,b))):f||this.blackInCheck()||(!(0<=this.board.castlingOptions.indexOf("k"))||this.board.hasPiece(a+1,b)||this.isSquareAttackedByWhite(a+1,b)||this.board.hasPiece(a+2,b)||this.isSquareAttackedByWhite(a+2,b)||e.push(g.name(a+2,b)),!(0<=this.board.castlingOptions.indexOf("q"))||this.board.hasPiece(a-
1,b)||this.isSquareAttackedByWhite(a-1,b)||this.board.hasPiece(a-2,b)||this.isSquareAttackedByWhite(a-2,b)||e.push(g.name(a-2,b))));return e},isValidMove:function(a,b){var e,c;"object"==typeof a?(e=a,c=g.name(b.file,b.rank)):(e=g.coords(a.substr(0,2)),c=a.substr(2,2));if(!this.board.hasPiece(e.file,e.rank)||h.getColor(this.board.getPiece(e.file,e.rank))!=this.board.getColorToMove())return!1;e=this.getValidMovesForSquare(e.file,e.rank);for(var f=0;f<e.length;f++)if(e[f]===c)return!0;return!1},determineCoveredSquares:function(a){if(!(a&&
0<this.whiteCoveredSquares.length||!a&&0<this.blackCoveredSquares.legnth)){a&&(this.whiteCoveredSquares=[]);a||(this.blackCoveredSquares=[]);for(var b,e=1;9>e;e++)for(var c=1;9>c;c++)if(this.board.hasPiece(e,c)){var f=h.isWhite(this.board.getPiece(e,c));if(f==a){b=this.board.getCoveredSquares(e,c);var d=this.blackCoveredSquares;f&&(d=this.whiteCoveredSquares);for(f=0;f<b.length;f++)d.push(b[f])}}}},findPiece:function(a){for(var b=[],e=1;9>e;e++)for(var c=1;9>c;c++)this.board.hasPiece(e,c)&&this.board.getPiece(e,
c)==a&&b.push({file:e,rank:c});return b},isSquareAttacked:function(a,b){if(!this.board.hasPiece(a,b))return!1;var e=g.name(a,b),c;c=h.isWhite(this.board.getPiece(a,b))?this.getBlacksCoveredSquares():this.getWhitesCoveredSquares();for(var f=0;f<c.length;f++)if(c[f]==e)return!0;return!1},isSquareAttackedByWhite:function(a,b){for(var e=g.name(a,b),c=this.getWhitesCoveredSquares(),f=0;f<c.length;f++)if(c[f]==e)return!0;return!1},isSquareAttackedByBlack:function(a,b){for(var c=g.name(a,b),d=this.getBlacksCoveredSquares(),
f=0;f<d.length;f++)if(d[f]==c)return!0;return!1},getPositionFEN:function(){if(this.cachedPositionFEN)return this.cachedPositionFEN;for(var a=[],b=8;0<b;b--){for(var c="",d=0,f=1;9>f;f++)this.board.hasPiece(f,b)?(0<d&&(c+=d,d=0),c+=this.board.getPiece(f,b)):d++;0<d&&(c+=d);a.push(c)}return this.cachedPositionFEN=a.join("/")},setFEN:function(a){this.resetCaches();this.board.setFEN(a)},setFromBoard:function(a){this.resetCaches();this.board.copyFrom(a)},blackInCheck:function(){var a=this.findPiece("k");
return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)},whiteInCheck:function(){var a=this.findPiece("K");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)},blackInCheckmate:function(){var a=this.findPiece("k");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)&&0==this.getValidMovesForBlack().length},whiteInCheckmate:function(){var a=this.findPiece("K");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)&&0==this.getValidMovesForWhite().length},
moves:function(a){"string"==typeof a&&(a=a.split(" "));for(var b=0;b<a.length;b++)if(!this.move(a[b]))return!1;return!0},move:function(a,b){var c,d,f,l;b=!0===b?!0:!1;c=g.coords(a.substr(0,2));d=g.coords(a.substr(2,2));4<a.length&&a.substr(4,1);if(!this.board.hasPiece(c.file,c.rank)||!b&&!this.isValidMove(c,d))return!1;f=this.board.getPiece(c.file,c.rank);this.board.removePiece(c.file,c.rank);this.board.setPiece(f,d.file,d.rank);if(("k"==f||"K"==f)&&2==Math.abs(c.file-d.file)){d.file>c.file?(f=d.file+
1,l=d.rank,c=d.file-1):(f=d.file-2,l=d.rank,c=d.file+1);d=d.rank;var k=this.board.getPiece(f,l);this.board.removePiece(f,l);this.board.setPiece(k,c,d);h.isWhite(k)?this.board.castlingOptions=this.board.castlingOptions.replace("KQ",""):this.board.castlingOptions=this.board.castlingOptions.replace("kq","");""==this.board.castlingOptions&&(this.board.castlingOptions="-")}this.board.incrementMove();this.resetCaches();return!0},getWhiteStaticValue:function(){this.determineStaticValues();return this.whiteStaticValue},
getBlackStaticValue:function(){this.determineStaticValues();return this.blackStaticValue},determineStaticValues:function(){if(!(0<this.whiteStaticValue||0<this.blackStaticValue)){this.blackStaticValue=this.whiteStaticValue=0;for(var a,b=1;9>b;b++)for(var c=1;9>c;c++)if(this.board.hasPiece(b,c)){switch(this.board.getPiece(b,c)){case "Q":case "q":a=9.75;break;case "R":case "r":a=5;break;case "B":case "b":a=3.25;break;case "N":case "n":a=3.25;break;case "P":case "p":a=1;break;default:continue}a*=10;
h.isWhite(this.board.getPiece(b,c))?this.whiteStaticValue+=a:this.blackStaticValue+=a}}},getWhiteDynamicValue:function(){this.determineDynamicValues();return this.whiteDynamicValue},getBlackDynamicValue:function(){this.determineDynamicValues();return this.blackDynamicValue},determineDynamicValues:function(){if(!(0<this.whiteDynamicValue||0<this.blackDynamicValue)){this.blackDynamicValue=this.whiteDynamicValue=0;2<=this.findPiece("b").length&&(this.blackDynamicValue+=5);2<=this.findPiece("B").length&&
(this.whiteDynamicValue+=5);var a=this.getBlacksCoveredSquares();this.blackDynamicValue+=Math.round(a.length/2);a=this.getWhitesCoveredSquares();this.whiteDynamicValue+=Math.round(a.length/2)}},getBestMoveForWhite:function(){return this.getBestMove(!0)},getBestMoveForBlack:function(){return this.getBestMove(!1)},getBestMoveSimple:function(a){for(var b=[],c=1;9>c;c++)for(var d=1;9>d;d++)if(this.board.hasPiece(c,d)&&h.isWhite(this.board.getPiece(c,d))==a){var f=this.getValidMovesForSquare(c,d);if(0!=
f.length)for(var l=0;l<f.length;l++){var k=""+g.name(c,d)+f[l].name,m=this.evaluateMove(k);if(1E3==Math.abs(m))return k;b.push({move:k,value:m})}}c=function(a,b){return a.value-b.value};a&&(c=function(a,b){return b.value-a.value});b.sort(c);if(this.mark)for(l=0;l<b.length;l++)console.log(b[l].move+": "+b[l].value);return b[0].move},evaluateMove:function(a){var b=this.clone();b.move(a);return b.evaluatePosition()},clone:function(){var a=EngineFactory.create();a.setFromBoard(a.board);return a}},c,d;
q.getBestMove=function(a){this.lastBestMove="";c=this.lastValue=0;d={};var b=(new Date).getTime();this.alphabeta(3,-1E4,1E4,a);b=((new Date).getTime()-b)/1E3;console.log((a?"white":"black")+" to move; examined: "+c+" nodes in "+b+"s ("+Math.round(c/b)+"n/s); best: "+this.lastBestMove+" ("+this.lastValue+")");return this.lastBestMove};q.alphabeta=function(a,b,e,g){c++;var f=this.getPositionFEN()+" "+(this.board.getColorToMove()==n.white?"w":"b"),l;if(0==a){if(d[f])return d[f];l=this.evaluatePosition();
return d[f]=l}var f=this.clone(),k,m;if(g){k=this.getValidMovesForWhite();for(var h=0;h<k.length;h++){f.setFromBoard(this.board);f.move(k[h]);m=b;if(f.blackInCheckmate()){b=1E3;this.lastBestMove=k[h];this.lastValue=b;break}else l=f.alphabeta(a-1,b,e,!g),b=Math.max(b,l);m!=b&&(this.lastBestMove=k[h],this.lastValue=l);if(e<=b)break}return b}k=this.getValidMovesForBlack();for(h=0;h<k.length;h++){f.setFromBoard(this.board);f.move(k[h]);m=e;if(f.whiteInCheckmate()){e=-1E3;this.lastBestMove=k[h];this.lastValue=
e;break}else l=f.alphabeta(a-1,b,e,!g),e=Math.min(e,l);m!=e&&(this.lastBestMove=k[h],this.lastValue=e);if(e<=b)break}return e};q.evaluatePosition=function(){if(this.whiteInCheckmate())return-1E3;if(this.blackInCheckmate())return 1E3;var a;a=0+this.getWhiteStaticValue();a-=this.getBlackStaticValue();a+=this.getWhiteDynamicValue();return a-=this.getBlackDynamicValue()};EngineFactory=function(){return{create:function(a){"undefined"===typeof a&&(a=BoardFactory.create());return Object.create(q).init(a)}}}()})();
