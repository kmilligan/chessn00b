var BoardFactory;
(function(){"function"!==typeof Object.create&&(Object.create=function(c){function e(){}e.prototype=c;return new e});var h={R:"\u2656",N:"\u2658",B:"\u2657",Q:"\u2655",K:"\u2654",P:"\u2659",r:"\u265c",n:"\u265e",b:"\u265d",q:"\u265b",k:"\u265a",p:"\u265f",isWhite:function(c){return 91>c.charCodeAt(0)?!0:!1},getColor:function(c){return this.isWhite(c)?g.white:g.black}},q={1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",name:function(c,e){return q[c]+
e},coords:function(c){return{file:parseInt(q[c.substr(0,1)],10),rank:parseInt(c.substr(1,1),10)}}},g={white:8,black:0},s={init:function(){this.colorToMove=g.white;this.enpassantTarget=this.castlingOptions="-";this.fullMoveNumber=this.halfMoveClock=0;this.squares=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,0,0,0,0,0,0,0,0,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.squareColors=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,8,0,8,0,8,0,8,0,-1,-1,0,8,0,8,0,8,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];return this},setFEN:function(c){c=c.split(" ");for(var e=c[0].split("/"),a=8;0<a;a--)this.setRankFEN(a,e[8-a]);this.colorToMove=
"w"==c[1]?g.white:g.black;c[2]&&(this.castlingOptions=c[2]);c[3]&&(this.enpassantTarget=c[3]);"undefined"!=typeof c[4]&&(this.halfMoveClock=parseInt(c[4],10));"undefined"!=typeof c[5]&&(this.fullMoveNumber=parseInt(c[5],10))},setRankFEN:function(c,e){var a=e.split(""),b=1,d;for(d in a){if(8<b||" "==a[d])break;if(h[a[d]])this.setPiece(a[d],b,c),b++;else for(;0<a[d];)this.removePiece(b,c),a[d]--,b++}},getColorToMove:function(){return this.colorToMove},incrementMove:function(){this.colorToMove==g.white?
this.colorToMove=g.black:(this.colorToMove=g.white,this.fullMoveNumber++)},ap:function(c,e){return 10*(10-parseInt(e,10))+parseInt(c,10)},apToName:function(c){return q.name(c%10,10-Math.floor(c/10))},setPiece:function(c,e,a){this.squares[this.ap(e,a)]=c},removePiece:function(c,e){this.squares[this.ap(c,e)]=0},hasPiece:function(c,e){var a;a="undefined"===typeof e?c:this.ap(c,e);return"string"===typeof this.squares[a]?!0:!1},getPiece:function(c,e){return this.squares[this.ap(c,e)]},getSquareColor:function(c,
e){"undefined"==typeof e&&"string"==typeof c&&(e=c.substr(1,1),c=q[c.substr(0,1)]);return this.squareColors[this.ap(c,e)]},getCoveredSquares:function(c,e){var a=[],b=[];switch(this.getPiece(c,e)){case "K":case "k":a=this.getStraightOptions(c,e,1);b=this.getDiagonalOptions(c,e,1);break;case "Q":case "q":a=this.getStraightOptions(c,e,8);b=this.getDiagonalOptions(c,e,8);break;case "R":case "r":a=this.getStraightOptions(c,e,8);break;case "B":case "b":b=this.getDiagonalOptions(c,e,8);break;case "N":case "n":a=
this.getKnightOptions(c,e);break;case "P":case "p":a=this.getPawnOptions(c,e)}for(var d=0;d<b.length;d++)a.push(b[d]);return a},getStraightOptions:function(c,e,a){for(var b=[],d=[-1,-10,1,10],p=this.ap(c,e),f,k=0;k<d.length;k++)for(e=d[k],f=p,c=0;c<a;){f+=e;if(0>this.squares[f])break;b.push(this.apToName(f));if(this.hasPiece(f))break;c++}return b},getDiagonalOptions:function(c,e,a){for(var b=[],d=[-11,-9,9,11],p=this.ap(c,e),f,k=0;k<d.length;k++)for(e=d[k],f=p,c=0;c<a;){f+=e;if(0>this.squares[f])break;
b.push(this.apToName(f));if(this.hasPiece(f))break;c++}return b},getKnightOptions:function(c,e){for(var a=[],b=[-21,-19,-8,12,21,19,8,-12],d,p=this.ap(c,e),f=0;f<b.length;f++)d=b[f],d=p+d,0>this.squares[d]||a.push(this.apToName(d));return a},getPawnOptions:function(c,e){for(var a=[],b=h.isWhite(this.getPiece(c,e))?[-11,-9]:[11,9],d,p=this.ap(c,e),f=0;f<b.length;f++)d=b[f],d=p+d,0>this.squares[d]||a.push(this.apToName(d));return a},dump:function(){console.log("-----------------");for(var c=8;0<c;c--){for(var e=
"|",a=1;9>a;a++)e=this.hasPiece(a,c)?e+this.getPiece(a,c):e+" ",e+="|";console.log(e);console.log("-----------------")}}};BoardFactory=function(){return{create:function(){return Object.create(s).init()},getPieceMap:function(){return h},getFileMap:function(){return q},getColorMap:function(){return g}}}()})();
(function(h){h.fn.chessn00b=function(b){b||(b={});if("string"==typeof b&&1==this.length&&this[0].displayboard)switch(b){case "fen":return this[0].displayboard.getFEN();default:return"unsupported option"}return this.each(function(){if(!this.displayboard){var d="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";b.fen&&(d=b.fen);b.element=h(this);this.displayboard=Object.create(a).init(b);this.displayboard.setFEN(d)}})};var q=BoardFactory.getPieceMap(),g=BoardFactory.getColorMap(),s=BoardFactory.getFileMap(),
c={"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR":["e7e5"],"rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppppppp/8/8/2P5/8/PP1PPPPP/RNBQKBNR":["g8f6"],"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R":["b8c6"],"rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR":["g7g6"]},e={init:function(b){this.square=b;this.element=h('<div class="chessn00b-square">&nbsp;</div>');this.element[0].displaySquare=this;this.element.attr("rel",b.name);this.element.addClass(this.square.color==g.white?
"chessn00b-light-square":"chessn00b-dark-square");return this},lite:function(){this.element.addClass("chessn00b-square-lit")},unlite:function(){this.element.removeClass("chessn00b-square-lit")},toggleLite:function(){this.element.hasClass("chessn00b-square-lit")?this.unlite():this.lite()}},a={init:function(b){if(!b||!b.element)throw Error('Missing options; requires at least "element" to attach to.');"undefined"===typeof b.playGame&&(b.playGame=!0);this.element=b.element;this.board=BoardFactory.create();
this.engine=EngineFactory.create(this.board);this.playGame=b.playGame;this.lastClickedSquare=null;this.displaySquares=[];this.thinking=!1;this.id="board"+Math.floor(1E6*Math.random());this.element.addClass(this.id);for(b=1;9>b;b++)for(var a=1;9>a;a++)1==a&&(this.displaySquares[b]=[]),this.displaySquares[b][a]=Object.create(e).init({file:b,rank:a,color:this.board.getSquareColor(b,a),name:s.name(b,a)});this.createDisplay();return this},createDisplay:function(){for(var b=8;0<b;b--){for(var a=h('<div class="chessn00b-rank" rel="'+
b+'"></div>'),p=1;9>p;p++)a.append(this.displaySquares[p][b].element);this.element.append(a)}this.element.append('<div class="chessn00b-status"><span class="illegal-move">Illegal move. </span><span class="your-move">Your move</span><span class="game-over">Game Over. </span><span class="you-win">You win!</span><span class="you-lose">You win!</span><span class="thinking">Thinking...</span></div>');this.element.find(".illegal-move").hide();this.element.find(".thinking").hide();this.element.find(".game-over").hide();
this.element.find(".you-lose").hide();this.element.find(".you-win").hide();this.playGame||this.element.find(".your-move").hide();this.autosetHeight();var c=this;this.element.on("click",".chessn00b-square",function(){c.squareClicked(h(this));return!1})},autosetHeight:function(){var b=this.displaySquares[1][1].element.width();"undefined"==typeof this.dynCSS&&(this.dynCSS=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.dynCSS));b="."+this.id+" .chessn00b-square { font-size: "+
Math.ceil(.82*b)+"px;  height: "+b+"px;  line-height: "+b+"px; }";this.dynCSS.styleSheet?this.dynCSS.styleSheet.cssText=b:this.dynCSS.innerHTML=b},squareClicked:function(b){this.thinking||(this.element.find(".illegal-move").hide(),this.lastClickedSquare?b[0]==this.lastClickedSquare?(this.lastClickedSquare.displaySquare.unlite(),this.lastClickedSquare=null):(this.lastClickedSquare.displaySquare.unlite(),b=""+this.lastClickedSquare.displaySquare.square.name+b[0].displaySquare.square.name,this.engine.isValidMove(b)?
(this.engine.move(b),this.update(),this.lastClickedSquare=null,this.playGame&&this.autoMove()):(this.element.find(".illegal-move").show(),this.lastClickedSquare=null)):(b[0].displaySquare.lite(),this.lastClickedSquare=b[0]))},autoMove:function(){this.thinking=!0;this.element.find(".your-move").hide();this.element.find(".thinking").show();var b=this;setTimeout(function(){var a;if(b.engine.blackInCheckmate())b.thinking=!1,b.element.find(".thinking").hide(),b.element.find(".game-over").show(),b.element.find(".you-win").show();
else{if(a=c[b.getFEN()]){var p=Math.round(Math.random()*(a.length-1));a=a[p];console.log("book move used")}else a=b.engine.getBestMoveForBlack();b.engine.move(a);b.thinking=!1;b.element.find(".thinking").hide();b.update();b.engine.whiteInCheckmate()?(b.element.find(".game-over").show(),b.element.find(".you-lose").show()):b.element.find(".your-move").show()}},0)},setFEN:function(b){this.board.setFEN(b);this.update();this.board.dump()},getFEN:function(){return this.engine.getPositionFEN()},update:function(){for(var b=
1;9>b;b++)for(var a=1;9>a;a++)this.board.hasPiece(b,a)||this.displaySquares[b][a].element.html("&nbsp;"),this.displaySquares[b][a].element.html(q[this.board.getPiece(b,a)])}}})(jQuery);if("undefined"===typeof BoardFactory)throw console&&console.log("Missing the BoardFactory!"),Error("Missing the BoardFactory!");var EngineFactory;
(function(){var h=BoardFactory.getPieceMap(),q=BoardFactory.getColorMap(),g=BoardFactory.getFileMap(),s={init:function(a){this.board=a;this.resetCaches();return this},resetCaches:function(){this.whiteCoveredSquares=[];this.blackCoveredSquares=[];this.blackDynamicValue=this.whiteDynamicValue=this.blackStaticValue=this.whiteStaticValue=0;this.cachedPositionFEN=null;this.validWhiteMoves=[];this.validBlackMoves=[]},getWhitesCoveredSquares:function(){this.determineCoveredSquares(!0);return this.whiteCoveredSquares},
getBlacksCoveredSquares:function(){this.determineCoveredSquares(!1);return this.blackCoveredSquares},getValidMovesForWhite:function(){this.determineValidMoves(!0);return this.validWhiteMoves},getValidMovesForBlack:function(){this.determineValidMoves(!1);return this.validBlackMoves},determineValidMoves:function(a){if(!(a&&0<this.validWhiteMoves.length||!a&&0<this.validBlackMoves.length)){a&&(this.validWhiteMoves=[]);a||(this.validBlackMoves=[]);for(var b,d,p,c,e=1;9>e;e++)for(var l=1;9>l;l++)if(this.board.hasPiece(e,
l)&&(b=g.name(e,l),p=h.isWhite(this.board.getPiece(e,l)),p==a)){c=this.getValidMovesForSquare(e,l);for(var m=0;m<c.length;m++)d=""+b+c[m],p?this.validWhiteMoves.push(d):this.validBlackMoves.push(d)}}},getValidMovesForSquare:function(a,b){var d=[];if(!this.board.hasPiece(a,b))return d;var c=this.board.getPiece(a,b),f=h.isWhite(c),e="k"==c||"K"==c?!0:!1,c="p"==c||"P"==c?!0:!1,l=g.name(a,b),m=this.getPositionFEN(),n=EngineFactory.create(),t=this.board.getCoveredSquares(a,b);if(0==t.length)return d;for(var q,
s,r,u=0;u<t.length;u++)q=g[t[u].substr(0,1)],s=t[u].substr(1,1),r=this.board.hasPiece(q,s),q=this.board.getPiece(q,s),r&&h.isWhite(q)==f||c&&!r||(n.setFEN(m),r=""+l+t[u],n.move(r,!0),f&&n.whiteInCheck()||!f&&n.blackInCheck()||d.push(t[u]));c&&(f?8>b&&!this.board.hasPiece(a,b+1)&&(n.setFEN(m),r=""+l+g.name(a,b+1),n.move(r,!0),n.whiteInCheck()||d.push(g.name(a,b+1)),2!=b||this.board.hasPiece(a,b+2)||(n.setFEN(m),r=""+l+g.name(a,b+2),n.move(r,!0),n.whiteInCheck()||d.push(g.name(a,b+2)))):1<b&&!this.board.hasPiece(a,
b-1)&&(n.setFEN(m),r=""+l+g.name(a,b-1),n.move(r,!0),n.blackInCheck()||d.push(g.name(a,b-1)),7!=b||this.board.hasPiece(a,b-2)||(n.setFEN(m),r=""+l+g.name(a,b-2),n.move(r,!0),n.blackInCheck()||d.push(g.name(a,b-2)))));e&&(f&&!this.whiteInCheck()?(!(0<=this.board.castlingOptions.indexOf("K"))||this.board.hasPiece(a+1,b)||this.isSquareAttackedByBlack(a+1,b)||this.board.hasPiece(a+2,b)||this.isSquareAttackedByBlack(a+2,b)||d.push(g.name(a+2,b)),!(0<=this.board.castlingOptions.indexOf("Q"))||this.board.hasPiece(a-
1,b)||this.isSquareAttackedByBlack(a-1,b)||this.board.hasPiece(a-2,b)||this.isSquareAttackedByBlack(a-2,b)||d.push(g.name(a-2,b))):f||this.blackInCheck()||(!(0<=this.board.castlingOptions.indexOf("k"))||this.board.hasPiece(a+1,b)||this.isSquareAttackedByWhite(a+1,b)||this.board.hasPiece(a+2,b)||this.isSquareAttackedByWhite(a+2,b)||d.push(g.name(a+2,b)),!(0<=this.board.castlingOptions.indexOf("q"))||this.board.hasPiece(a-1,b)||this.isSquareAttackedByWhite(a-1,b)||this.board.hasPiece(a-2,b)||this.isSquareAttackedByWhite(a-
2,b)||d.push(g.name(a-2,b))));return d},isValidMove:function(a,b){var d,c;"object"==typeof a?(d=a,c=g.name(b.file,b.rank)):(d=g.coords(a.substr(0,2)),c=a.substr(2,2));if(!this.board.hasPiece(d.file,d.rank)||h.getColor(this.board.getPiece(d.file,d.rank))!=this.board.getColorToMove())return!1;d=this.getValidMovesForSquare(d.file,d.rank);for(var f=0;f<d.length;f++)if(d[f]===c)return!0;return!1},determineCoveredSquares:function(a){if(!(a&&0<this.whiteCoveredSquares.length||!a&&0<this.blackCoveredSquares.legnth)){a&&
(this.whiteCoveredSquares=[]);a||(this.blackCoveredSquares=[]);for(var b,d=1;9>d;d++)for(var c=1;9>c;c++)if(this.board.hasPiece(d,c)){var f=h.isWhite(this.board.getPiece(d,c));if(f==a){b=this.board.getCoveredSquares(d,c);var e=this.blackCoveredSquares;f&&(e=this.whiteCoveredSquares);for(f=0;f<b.length;f++)e.push(b[f])}}}},findPiece:function(a){for(var b=[],d=1;9>d;d++)for(var c=1;9>c;c++)this.board.hasPiece(d,c)&&this.board.getPiece(d,c)==a&&b.push({file:d,rank:c});return b},isSquareAttacked:function(a,
b){if(!this.board.hasPiece(a,b))return!1;var d=g.name(a,b),c;c=h.isWhite(this.board.getPiece(a,b))?this.getBlacksCoveredSquares():this.getWhitesCoveredSquares();for(var f=0;f<c.length;f++)if(c[f]==d)return!0;return!1},isSquareAttackedByWhite:function(a,b){for(var d=g.name(a,b),c=this.getWhitesCoveredSquares(),f=0;f<c.length;f++)if(c[f]==d)return!0;return!1},isSquareAttackedByBlack:function(a,b){for(var d=g.name(a,b),c=this.getBlacksCoveredSquares(),f=0;f<c.length;f++)if(c[f]==d)return!0;return!1},
getPositionFEN:function(){if(this.cachedPositionFEN)return this.cachedPositionFEN;for(var a=[],b=8;0<b;b--){for(var d="",c=0,f=1;9>f;f++)this.board.hasPiece(f,b)?(0<c&&(d+=c,c=0),d+=this.board.getPiece(f,b)):c++;0<c&&(d+=c);a.push(d)}return this.cachedPositionFEN=a.join("/")},setFEN:function(a){this.resetCaches();this.board.setFEN(a)},blackInCheck:function(){var a=this.findPiece("k");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)},whiteInCheck:function(){var a=this.findPiece("K");
return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)},blackInCheckmate:function(){var a=this.findPiece("k");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)&&0==this.getValidMovesForSquare(a[0].file,a[0].rank).length},whiteInCheckmate:function(){var a=this.findPiece("K");return 0==a.length?!1:this.isSquareAttacked(a[0].file,a[0].rank)&&0==this.getValidMovesForSquare(a[0].file,a[0].rank).length},moves:function(a){"string"==typeof a&&(a=a.split(" "));for(var b=0;b<a.length;b++)if(!this.move(a[b]))return!1;
return!0},move:function(a,b){var c,e,f,k;b=!0===b?!0:!1;c=g.coords(a.substr(0,2));e=g.coords(a.substr(2,2));4<a.length&&a.substr(4,1);if(!this.board.hasPiece(c.file,c.rank)||!b&&!this.isValidMove(c,e))return!1;f=this.board.getPiece(c.file,c.rank);this.board.removePiece(c.file,c.rank);this.board.setPiece(f,e.file,e.rank);if(("k"==f||"K"==f)&&2==Math.abs(c.file-e.file)){e.file>c.file?(f=e.file+1,k=e.rank,c=e.file-1):(f=e.file-2,k=e.rank,c=e.file+1);e=e.rank;var l=this.board.getPiece(f,k);this.board.removePiece(f,
k);this.board.setPiece(l,c,e);h.isWhite(l)?this.board.castlingOptions=this.board.castlingOptions.replace("KQ",""):this.board.castlingOptions=this.board.castlingOptions.replace("kq","");""==this.board.castlingOptions&&(this.board.castlingOptions="-")}this.board.incrementMove();this.resetCaches();return!0},getWhiteStaticValue:function(){this.determineStaticValues();return this.whiteStaticValue},getBlackStaticValue:function(){this.determineStaticValues();return this.blackStaticValue},determineStaticValues:function(){if(!(0<
this.whiteStaticValue||0<this.blackStaticValue)){this.blackStaticValue=this.whiteStaticValue=0;for(var a,b=1;9>b;b++)for(var c=1;9>c;c++)if(this.board.hasPiece(b,c)){switch(this.board.getPiece(b,c)){case "Q":case "q":a=9.75;break;case "R":case "r":a=5;break;case "B":case "b":a=3.25;break;case "N":case "n":a=3.25;break;case "P":case "p":a=1;break;default:continue}a*=10;h.isWhite(this.board.getPiece(b,c))?this.whiteStaticValue+=a:this.blackStaticValue+=a}}},getWhiteDynamicValue:function(){this.determineDynamicValues();
return this.whiteDynamicValue},getBlackDynamicValue:function(){this.determineDynamicValues();return this.blackDynamicValue},determineDynamicValues:function(){if(!(0<this.whiteDynamicValue||0<this.blackDynamicValue)){this.blackDynamicValue=this.whiteDynamicValue=0;2<=this.findPiece("b").length&&(this.blackDynamicValue+=5);2<=this.findPiece("B").length&&(this.whiteDynamicValue+=5);var a=this.getBlacksCoveredSquares();this.blackDynamicValue+=Math.round(a.length/2);a=this.getWhitesCoveredSquares();this.whiteDynamicValue+=
Math.round(a.length/2)}},getBestMoveForWhite:function(){return this.getBestMove(!0)},getBestMoveForBlack:function(){return this.getBestMove(!1)},getBestMoveSimple:function(a){for(var b=[],c=1;9>c;c++)for(var e=1;9>e;e++)if(this.board.hasPiece(c,e)&&h.isWhite(this.board.getPiece(c,e))==a){var f=this.getValidMovesForSquare(c,e);if(0!=f.length)for(var k=0;k<f.length;k++){var l=""+g.name(c,e)+f[k].name,m=this.evaluateMove(l);if(1E3==Math.abs(m))return l;b.push({move:l,value:m})}}c=function(a,b){return a.value-
b.value};a&&(c=function(a,b){return b.value-a.value});b.sort(c);if(this.mark)for(k=0;k<b.length;k++)console.log(b[k].move+": "+b[k].value);return b[0].move},evaluateMove:function(a){var b=this.clone();b.move(a);return b.evaluatePosition()},clone:function(){var a=EngineFactory.create();a.setFEN(this.getPositionFEN()+" "+(this.board.getColorToMove()==q.white?"w":"b"));return a}},c,e;s.getBestMove=function(a){this.lastBestMove="";c=this.lastValue=0;e={};var b=(new Date).getTime();this.alphabeta(3,-1E4,
1E4,a);b=((new Date).getTime()-b)/1E3;console.log((a?"white":"black")+" to move; examined: "+c+" nodes in "+b+"s ("+Math.round(c/b)+"n/s); best: "+this.lastBestMove+" ("+this.lastValue+")");return this.lastBestMove};s.alphabeta=function(a,b,d,g){c++;var f=this.getPositionFEN()+" "+(this.board.getColorToMove()==q.white?"w":"b"),k;if(0==a){if(e[f])return e[f];k=this.evaluatePosition();return e[f]=k}var l=this.clone(),m,n;if(g){m=this.getValidMovesForWhite();for(var h=0;h<m.length;h++){l.setFEN(f);l.move(m[h]);
n=b;if(l.blackInCheckmate()){b=1E3;this.lastBestMove=m[h];this.lastValue=b;break}else k=l.alphabeta(a-1,b,d,!g),b=Math.max(b,k);n!=b&&(this.lastBestMove=m[h],this.lastValue=k);if(d<=b)break}return b}m=this.getValidMovesForBlack();for(h=0;h<m.length;h++){l.setFEN(f);l.move(m[h]);n=d;if(l.whiteInCheckmate()){d=-1E3;this.lastBestMove=m[h];this.lastValue=d;break}else k=l.alphabeta(a-1,b,d,!g),d=Math.min(d,k);n!=d&&(this.lastBestMove=m[h],this.lastValue=d);if(d<=b)break}return d};s.evaluatePosition=function(){if(this.whiteInCheckmate())return-1E3;
if(this.blackInCheckmate())return 1E3;var a;a=0+this.getWhiteStaticValue();a-=this.getBlackStaticValue();a+=this.getWhiteDynamicValue();return a-=this.getBlackDynamicValue()};EngineFactory=function(){return{create:function(a){"undefined"===typeof a&&(a=BoardFactory.create());return Object.create(s).init(a)}}}()})();
